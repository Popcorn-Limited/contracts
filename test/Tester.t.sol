// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import {Test, console2} from "forge-std/Test.sol";
import {stdJson} from "forge-std/StdJson.sol";

import {ERC4626Upgradeable, IERC20, IERC20Metadata, ERC20Upgradeable as ERC20} from "openzeppelin-contracts-upgradeable/token/ERC20/extensions/ERC4626Upgradeable.sol";

import {BytesLib} from "./BytesLib.sol";

library LibString {
    function replace(
        string memory subject,
        string memory search, 
        string memory replacement
    ) internal pure returns (string memory result) {
        assembly {
            let subjectLength := mload(subject)
            let searchLength := mload(search)
            let replacementLength := mload(replacement)

            // Store the mask for sub-word comparisons in the scratch space.
            mstore(0x00, not(0))
            mstore(0x20, 0)

            subject := add(subject, 0x20)
            search := add(search, 0x20)
            replacement := add(replacement, 0x20)
            result := add(mload(0x40), 0x20)

            let k := 0

            let subjectEnd := add(subject, subjectLength)
            if iszero(gt(searchLength, subjectLength)) {
                let subjectSearchEnd := add(sub(subjectEnd, searchLength), 1)
                for {} lt(subject, subjectSearchEnd) {} {
                    let o := and(searchLength, 31)
                    // Whether the first `searchLength % 32` bytes of 
                    // `subject` and `search` matches.
                    let l := iszero(and(xor(mload(subject), mload(search)), mload(sub(0x20, o))))
                    // Iterate through the rest of `search` and check if any word mismatch.
                    // If any mismatch is detected, `l` is set to 0.
                    for {} and(lt(o, searchLength), l) {} {
                        l := eq(mload(add(subject, o)), mload(add(search, o)))
                        o := add(o, 0x20)
                    }
                    // If `l` is one, there is a match, and we have to copy the `replacement`.
                    if l {
                        // Copy the `replacement` one word at a time.
                        for { o := 0 } lt(o, replacementLength) { o := add(o, 0x20) } {
                            mstore(add(result, add(k, o)), mload(add(replacement, o)))
                        }
                        k := add(k, replacementLength)
                        subject := add(subject, searchLength)
                    }
                    // If `l` or `searchLength` is zero.
                    if iszero(mul(l, searchLength)) {
                        mstore(add(result, k), mload(subject))
                        k := add(k, 1)
                        subject := add(subject, 1)
                    }
                }
            }

            let resultRemainder := add(result, k)
            k := add(k, sub(subjectEnd, subject))
            // Copy the rest of the string one word at a time.
            for {} lt(subject, subjectEnd) {} {    
                mstore(resultRemainder, mload(subject))
                resultRemainder := add(resultRemainder, 0x20)
                subject := add(subject, 0x20)
            }
            // Allocate memory for the length and the bytes, rounded up to a multiple of 32.
            mstore(0x40, add(result, and(add(k, 64), not(31))))
            result := sub(result, 0x20)
            mstore(result, k)
        }
    }
}

interface VaultRouter_I {
    function depositAndStake(
        address vault,
        address gauge,
        uint256 assetAmount,
        address receiver
    ) external;

    function unstakeAndWithdraw(
        address vault,
        address gauge,
        uint256 burnAmount,
        address receiver
    ) external;
}

struct BatchSwapStep {
    bytes32 poolId;
    uint256 assetInIndex;
    uint256 assetOutIndex;
    uint256 amount;
    bytes userData;
}

struct FixedAddressArray {
    address[11] fixed_;
}

struct FixedUintArray {
    uint256[5] swapParams;
}

interface IAsset {}

contract Tester is Test {
    using LibString for string;
    using BytesLib for bytes;

    VaultRouter_I router =
        VaultRouter_I(0x4995F3bb85E1381D02699e2164bC1C6c6Fa243cd);
    address Vault = address(0x7CEbA0cAeC8CbE74DB35b26D7705BA68Cb38D725);
    address adapter = address(0xF6Fe643cb8DCc3E379Cdc6DB88818B09fdF2200d);
    IERC20 asset = IERC20(0xA1290d69c65A6Fe4DF752f95823fae25cB99e5A7);

    function setUp() public {
        vm.selectFork(vm.createFork("mainnet"));
    }

    function testA() public {
        string
            memory tester = "b6b55f250000000000000000000000000000000000000000000000008ac7230489e80000";
        emit log_string(tester.replace("8ac7230489e8", "aaaaa"));
    }
}


//     hex"b35d7e73000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000002540be400000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000013095ea7b3010001ffffffffffc02aaa39b223fe8d0a0e5c4f27ead9083c756cc219198595a30283ffffffff83def1c0ded9bec7f1a1670819833240f027b25eff9bd3b227018302ffffffff036675a323dedb77822fcf39eaa9d682f6abe72555ddcd52200103ffffffffff037e7d64d987cab6eed08a191c4c2459daf2f8ed0b095ea7b3010403fffffffffff1376bcef0f78459c0ed0ba5ddce976f1ddf51f420e8c5650105060302ffff03c430db19339a3051192233b4c49f9ab3dc6d16b75b42f5e3810703ffffffff06263833d47ea3fa4a30f269323aba6a107f9eb14c9bd3b227018608ffffffff066675a323dedb77822fcf39eaa9d682f6abe72555ddcd52200106ffffffffff067e7d64d987cab6eed08a191c4c2459daf2f8ed0b4bf6a8f0010609ffffffff09d0af6f692bfa10d6a535a3a321dc8377f4eeef124bf6a8f001060affffffff0ad0af6f692bfa10d6a535a3a321dc8377f4eeef12095ea7b3010b03ffffffffffc430db19339a3051192233b4c49f9ab3dc6d16b770a08231010cffffffffff0bbae2df4dfcd0c613018d6056a40077f2d1eff28a58bda475c1000000000000ff00000000005bbb0ef59571e58418f9a4357b68a00c070302090a060d0e8fffffffffffffffffffffffffffffffffffffffffffff70a08231010cffffffffff0cbae2df4dfcd0c613018d6056a40077f2d1eff28ab67d77c5010c0bffffffff0cca99eaa38e8f37a168214a3a57c9a45a58563ed56e7a43a3010c10ffffffff0c7e7d64d987cab6eed08a191c4c2459daf2f8ed0b241c5912010cffffffffffff7e7d64d987cab6eed08a191c4c2459daf2f8ed0b00000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000026000000000000000000000000000000000000000000000000000000000000002a000000000000000000000000000000000000000000000000000000000000002e00000000000000000000000000000000000000000000000000000000000000a800000000000000000000000000000000000000000000000000000000000000ac00000000000000000000000000000000000000000000000000000000000000b000000000000000000000000000000000000000000000000000000000000000b400000000000000000000000000000000000000000000000000000000000000b800000000000000000000000000000000000000000000000000000000000000bc00000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000c400000000000000000000000000000000000000000000000000000000000000c800000000000000000000000000000000000000000000000000000000000000cc00000000000000000000000000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000d400000000000000000000000000000000000000000000000000000000000000e600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000def1c0ded9bec7f1a1670819833240f027b25eff000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000002540be400000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000768415565b0000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000f1376bcef0f78459c0ed0ba5ddce976f1ddf51f400000000000000000000000000000000000000000000000000000002540be400000000000000000000000000000000000000000000000000000000021f1b2ea200000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000420000000000000000000000000000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000000210000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000f1376bcef0f78459c0ed0ba5ddce976f1ddf51f400000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000320000000000000000000000000000000000000000000000000000000000000032000000000000000000000000000000000000000000000000000000000000002e000000000000000000000000000000000000000000000000000000002540be400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000012556e697377617056330000000000000000000000000000000000000000000000000000000000000000000002540be400000000000000000000000000000000000000000000000000000000021fec0c58000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000e592427a0aece92de3edee1f18e0157c0586156400000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002bc02aaa39b223fe8d0a0e5c4f27ead9083c756cc20001f4f1376bcef0f78459c0ed0ba5ddce976f1ddf51f4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000f1376bcef0f78459c0ed0ba5ddce976f1ddf51f40000000000000000000000000000000000000000000000000000000000d0ddb6000000000000000000000000ad01c20d5886137e056775af56915de824c8fce5000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000002000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000000000000000000000000000000000000000000000869584cd0000000000000000000000001000000000000000000000000000000000000011000000000000000000000000000000002527730371494f6cf90c781c4d975a1b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000c430db19339a3051192233b4c49f9ab3dc6d16b700000000000000000000000000000000000000000000000000000000000000200000000000000000000000007d585b0e27bbb3d981b7757115ec11f47c4769940000000000000000000000000000000000000000000000000000000000000020000000000000000000000000f1376bcef0f78459c0ed0ba5ddce976f1ddf51f40000000000000000000000000000000000000000000000000000000000000020000000000000000000000000bae2df4dfcd0c613018d6056a40077f2d1eff28a00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000025e400000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002cec000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000005bbb0ef59571e58418f9a4357b68a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa960450000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000009184e72a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000001219c90f6"


// hex"b35d7e73000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000000000000000000000000006acad34256e6ff3b3000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000013095ea7b3010001ffffffffffc02aaa39b223fe8d0a0e5c4f27ead9083c756cc219198595a30283ffffffff83179dc3fb0f2230094894317f307241a52cdb38aa9bd3b227018304ffffffff036675a323dedb77822fcf39eaa9d682f6abe72555ddcd52200103ffffffffff037e7d64d987cab6eed08a191c4c2459daf2f8ed0b095ea7b3010503fffffffffff1376bcef0f78459c0ed0ba5ddce976f1ddf51f420e8c5650106070302ffff03c430db19339a3051192233b4c49f9ab3dc6d16b75b42f5e3810803ffffffff07263833d47ea3fa4a30f269323aba6a107f9eb14c9bd3b227018709ffffffff076675a323dedb77822fcf39eaa9d682f6abe72555ddcd52200107ffffffffff077e7d64d987cab6eed08a191c4c2459daf2f8ed0b4bf6a8f001070affffffff0ad0af6f692bfa10d6a535a3a321dc8377f4eeef124bf6a8f001070bffffffff0bd0af6f692bfa10d6a535a3a321dc8377f4eeef12095ea7b3010c03ffffffffffc430db19339a3051192233b4c49f9ab3dc6d16b770a08231010dffffffffff0cbae2df4dfcd0c613018d6056a40077f2d1eff28a58bda475c1000000000000ff00000000005bbb0ef59571e58418f9a4357b68a00d0803020a0b070e0f90ffffffffffffffffffffffffffffffffffffffffffff70a08231010dffffffffff0dbae2df4dfcd0c613018d6056a40077f2d1eff28ab67d77c5010d0cffffffff0dca99eaa38e8f37a168214a3a57c9a45a58563ed56e7a43a3010d11ffffffff0d7e7d64d987cab6eed08a191c4c2459daf2f8ed0b241c5912010dffffffffffff7e7d64d987cab6eed08a191c4c2459daf2f8ed0b00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000240000000000000000000000000000000000000000000000000000000000000028000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000ba00000000000000000000000000000000000000000000000000000000000000be00000000000000000000000000000000000000000000000000000000000000c200000000000000000000000000000000000000000000000000000000000000c600000000000000000000000000000000000000000000000000000000000000ca00000000000000000000000000000000000000000000000000000000000000ce00000000000000000000000000000000000000000000000000000000000000d200000000000000000000000000000000000000000000000000000000000000d600000000000000000000000000000000000000000000000000000000000000da00000000000000000000000000000000000000000000000000000000000000de00000000000000000000000000000000000000000000000000000000000000e200000000000000000000000000000000000000000000000000000000000000e600000000000000000000000000000000000000000000000000000000000000ea00000000000000000000000000000000000000000000000000000000000000fc00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000179dc3fb0f2230094894317f307241a52cdb38aa0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000006acad34256e6ff3b3000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000864f0d7bb94000000000000000000000000b2f72662ed42067ccce278f8462a0215b6adcabb000000000000000000000000000000000000000000000006acad34256e6ff3b300000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000006661b09600000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000008400000000000000000000000000000000000000000000000000000000000000001000000000000000000000000f1376bcef0f78459c0ed0ba5ddce976f1ddf51f400000000000000000000000000000000000000000000000615e8411045a2a9790000000000000000000000007d585b0e27bbb3d981b7757115ec11f47c4769940000000000000000000000000000000000000000000000000000000000000001000000000000000000000000f1376bcef0f78459c0ed0ba5ddce976f1ddf51f400000000000000000000000000000000000000000000000000000000000000000000000000000000000000007d585b0e27bbb3d981b7757115ec11f47c47699400000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000004200000000000000000000000000000000000000000000000000a2cbe3b01f920000000000000000000000000000f2f4d68308db60d36268a602ef273421a22702100000000000000000000000000000000000000000000000000000000000000800002000000640000000000000f2f4d68308db60d36268a602ef273421a22702100000000000000000000000000000000000000000000000000000000000000843df021240000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000118fbef9b491fff000000000000000000000000ba12222222228d8ba445958a75a0704d566bf2c80000000000000000000000000000000000000000000000000000000000000080000200000184000000000000ba12222222228d8ba445958a75a0704d566bf2c800000000000000000000000000000000000000000000000000000000000001c452bbbe2900000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000b2f72662ed42067ccce278f8462a0215b6adcabb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b2f72662ed42067ccce278f8462a0215b6adcabb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdd59f89b5b07b7844d72996fc9d83d81acc8219600000000000000000000059e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000f1376bcef0f78459c0ed0ba5ddce976f1ddf51f4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000029afc890a21bfff000000000000000000000000466882ee013a5c9fb0e4e08ca0804f71ac58c6cc0000000000000000000000000000000000000000000000000000000000000080000000000064000000000000466882ee013a5c9fb0e4e08ca0804f71ac58c6cc00000000000000000000000000000000000000000000000000000000000000e4128acb08000000000000000000000000b2f72662ed42067ccce278f8462a0215b6adcabb0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000276a400000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000020000000000000000000000000c430db19339a3051192233b4c49f9ab3dc6d16b700000000000000000000000000000000000000000000000000000000000000200000000000000000000000007d585b0e27bbb3d981b7757115ec11f47c4769940000000000000000000000000000000000000000000000000000000000000020000000000000000000000000f1376bcef0f78459c0ed0ba5ddce976f1ddf51f40000000000000000000000000000000000000000000000000000000000000020000000000000000000000000bae2df4dfcd0c613018d6056a40077f2d1eff28a00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000025e400000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000002cec000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000005bbb0ef59571e58418f9a4357b68a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000d8da6bf26964af9d7eed9e03e53415d37aa960450000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000009184e72a00000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000335f73b1a395f2866"